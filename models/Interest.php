<?php
require_once __DIR__ . '/Model.php';

class Interest extends Model {
    protected static $tablename = 'interests';
    public static $pdo;

    private static $defaultCategories = [
        'Моё хобби' => [
            'Преданные компаньоны',
            'Игра и радость',
            'Обучение трюкам',
            'Забота о здоровье',
            'Прогулки',
            'Общение с владельцами',
            'Комфорт дома',
            'Творчество',
            'Мероприятия и выставки',
            'Тепло и ласка'
        ],
        'Мои любимые книги' => [
            'Мастер и Маргарита',
            'Преступление и наказание',
            'Война и мир',
            'Норвежский лес',
            '1984',
            'Маленький принц',
            'Имя розы',
            'Стив Джобс',
            'Классика',
            'Современная литература'
        ],
        'Моя любимая музыка' => [
            'Led Zeppelin',
            'Pink Floyd',
            'The Rolling Stones',
            'Muse',
            'Концерты',
            'Bohemian Rhapsody',
            'Кино',
            'Рок-фестивали',
            'Классический рок',
            'Современный рок'
        ],
        'Мои любимые фильмы' => [
            'Форрест Гамп',
            'Матрица',
            'Список Шиндлера',
            'Один дома',
            'Мстители: Война бесконечности',
            'Ушедшие',
            'Психо',
            'Документальные фильмы',
            'Фантастика',
            'Комедии'
        ]
    ];

    private static $defaultDescriptions = [
        // Моё хобби
        'Преданные компаньоны' => 'Собаки — мои самые преданные компаньоны, они всегда рядом, когда мне нужно внимание и поддержка.',
        'Игра и радость' => 'Я люблю наблюдать за тем, как они играют и радуются жизни, ведь каждая прогулка превращается в маленькое приключение.',
        'Обучение трюкам' => 'Обучение собак новым трюкам приносит мне огромное удовольствие, особенно когда вижу результаты своих усилий.',
        'Забота о здоровье' => 'Забота о здоровье моих питомцев — важная часть моего дня, я слежу за их питанием и регулярно посещаем ветеринара.',
        'Прогулки' => 'Прогулки на свежем воздухе с собаками помогают мне оставаться активным и заряжают энергией на весь день.',
        'Общение с владельцами' => 'Общение с другими владельцами собак позволяет обмениваться опытом и узнавать новые интересные факты о наших четвероногих друзьях.',
        'Комфорт дома' => 'Я стараюсь создавать для своих собак комфортные условия дома, чтобы они чувствовали себя уютно и безопасно.',
        'Творчество' => 'Мои собаки вдохновляют меня на творчество, часто я рисую их портреты или делаю фотографии.',
        'Мероприятия и выставки' => 'Вместе мы участвуем в различных мероприятиях и выставках, где можем показать свои навыки и пообщаться с единомышленниками.',
        'Тепло и ласка' => 'В конце дня ничто не сравнится с теплом и лаской, которую дарят мне мои любимые собаки.',

        // Мои любимые книги
        'Мастер и Маргарита' => 'Одной из моих любимых книг является «Мастер и Маргарита» Михаила Булгакова, которая поражает своей глубиной и многогранностью.',
        'Преступление и наказание' => 'Также я восхищаюсь произведениями Федора Достоевского, особенно романом «Преступление и наказание», который заставляет задуматься о природе добра и зла.',
        'Война и мир' => 'Люблю читать классику, и среди моих фаворитов — Лев Толстой с его эпопеей «Война и мир».',
        'Норвежский лес' => 'Современная литература тоже занимает важное место в моем сердце, например, романы Харуки Мураками, такие как «Норвежский лес», вызывают у меня сильные эмоции.',
        '1984' => 'Фантастика — еще одно направление, которое я ценю, и здесь нельзя не упомянуть «1984» Джорджа Оруэлла, произведение, которое до сих пор актуально.',
        'Маленький принц' => 'Среди детских книг особое место занимает «Маленький принц» Антуана де Сент-Экзюпери, который учит нас видеть красоту в простых вещах.',
        'Имя розы' => 'Я также увлекаюсь историческими романами, такими как «Имя розы» Умберто Эко, где переплетаются детективный сюжет и глубокие философские размышления.',
        'Стив Джобс' => 'В жанре нон-фикшн мне нравится читать биографии великих людей, например, «Стив Джобс» Уолтера Айзексона, которая раскрывает историю успеха одного из самых известных предпринимателей нашего времени.',
        'Классика' => 'Книги занимают особое место в моей жизни, они позволяют путешествовать во времени и пространстве, не выходя из дома.',
        'Современная литература' => 'Каждая книга, которую я читаю, оставляет след в моей душе и помогает мне лучше понимать окружающий мир и самого себя.',

        // Моя любимая музыка
        'Led Zeppelin' => 'Одним из моих любимых исполнителей является группа Led Zeppelin, чьи мощные риффы и харизматичный вокал Роберта Планта завораживают с первых нот.',
        'Pink Floyd' => 'Также я обожаю Pink Floyd с их атмосферными композициями и глубокими текстами, которые заставляют задуматься о смысле жизни.',
        'The Rolling Stones' => 'Классический рок никогда не устаревает, и среди моих фаворитов — The Rolling Stones, чья музыка остается актуальной уже несколько десятилетий.',
        'Muse' => 'Современный рок тоже имеет свое место в моем плейлисте, и здесь я выделяю группы вроде Muse, которые сочетают традиционные элементы рока с новыми звуковыми экспериментами.',
        'Концерты' => 'Я люблю посещать концерты, где могу почувствовать всю мощь живой музыки и энергию толпы.',
        'Bohemian Rhapsody' => 'Некоторые песни становятся настоящими гимнами, и одна из таких — «Bohemian Rhapsody» Queen, которая сочетает в себе разные музыкальные жанры и вызывает бурю эмоций.',
        'Кино' => 'Русский рок тоже занимает важное место в моём сердце, и тут невозможно не упомянуть группу «Кино» с её культовым лидером Виктором Цоем.',
        'Рок-фестивали' => 'Рок-фестивали — это особенное событие, где можно насладиться музыкой под открытым небом и встретить единомышленников.',
        'Классический рок' => 'Рок-музыка — это моя страсть, она наполняет мою жизнь энергией и эмоциями.',
        'Современный рок' => 'Рок-музыка для меня — это способ выразить свои чувства и переживания, она вдохновляет и поддерживает в трудные моменты.',

        // Мои любимые фильмы
        'Форрест Гамп' => 'Один из моих любимых фильмов — «Форрест Гамп», который рассказывает трогательную историю о простом человеке, преодолевающем трудности и находящем счастье в мелочах.',
        'Матрица' => 'Я также обожаю фантастические фильмы, и среди них выделяется «Матрица», которая перевернула представление о жанре и заставила задуматься о природе реальности.',
        'Список Шиндлера' => 'Исторические драмы тоже занимают важное место в моем списке предпочтений, и здесь нельзя не упомянуть «Список Шиндлера», который глубоко затрагивает тему человечности и сострадания.',
        'Один дома' => 'Комедии — отличный способ поднять настроение, и одним из моих фаворитов является «Один дома», который я пересматривал множество раз.',
        'Мстители: Война бесконечности' => 'Фильмы Marvel — это отдельный вид удовольствия, и особенно мне нравятся те, где задействованы супергерои, такие как «Мстители: Война бесконечности».',
        'Ушедшие' => 'Японское кино тоже привлекает мое внимание, и фильм «Ушедшие» Акиры Куросавы оставил неизгладимое впечатление своим глубоким смыслом и визуальной красотой.',
        'Психо' => 'Триллеры и ужасы — еще один жанр, который я люблю, и тут стоит отметить «Психо» Альфреда Хичкока, ставший классикой жанра.',
        'Документальные фильмы' => 'Документальные фильмы тоже имеют свою ценность, и я часто смотрю работы таких режиссеров, как Луи Терроу, которые открывают глаза на важные социальные проблемы.',
        'Фантастика' => 'Фильмы — это источник вдохновения и возможность погрузиться в другой мир, забыть о повседневных заботах.',
        'Комедии' => 'Каждый фильм, который я выбираю, становится частью моего опыта и помогает мне лучше понять мир вокруг и самого себя.'
    ];

    protected static function getDB() {
        if (!isset(self::$pdo)) {
            try {
                $dsn = 'mysql:host=localhost;dbname=web_db;charset=utf8';
                $username = 'root';
                $password = '';
                
                self::$pdo = new PDO($dsn, $username, $password);
                self::$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            } catch(PDOException $e) {
                error_log('Connection failed: ' . $e->getMessage());
                throw new Exception('Database connection failed');
            }
        }
        return self::$pdo;
    }

    public static function getAll() {
        try {
            static::setupConnection(); // Используем метод родительского класса
            if (!self::tableExists()) {
                return self::$defaultCategories;
            }

            $sql = "SELECT category, name FROM " . static::$tablename . " ORDER BY category, name";
            $stmt = static::$pdo->query($sql);
            
            $result = [];
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $result[$row['category']][] = $row['name'];
            }
            
            return empty($result) ? self::$defaultCategories : $result;
        } catch (Exception $e) {
            error_log($e->getMessage());
            return self::$defaultCategories;
        }
    }

    public static function getDescriptions() {
        try {
            static::setupConnection(); // Используем метод родительского класса
            if (!self::tableExists()) {
                return self::$defaultDescriptions;
            }

            $sql = "SELECT name, description FROM " . static::$tablename . " WHERE description IS NOT NULL";
            $stmt = static::$pdo->query($sql);
            
            $result = [];
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $result[$row['name']] = $row['description'];
            }
            
            return empty($result) ? self::$defaultDescriptions : $result;
        } catch (Exception $e) {
            error_log($e->getMessage());
            return self::$defaultDescriptions;
        }
    }

    protected static function tableExists() {
        try {
            static::setupConnection(); // Используем метод родительского класса
            $sql = "SHOW TABLES LIKE '" . static::$tablename . "'";
            $result = static::$pdo->query($sql);
            return $result->rowCount() > 0;
        } catch (Exception $e) {
            error_log($e->getMessage());
            return false;
        }
    }

    public static function createTable() {
        try {
            $db = self::getDB();
            $sql = "CREATE TABLE IF NOT EXISTS " . static::$tablename . " (
                id INT AUTO_INCREMENT PRIMARY KEY,
                category VARCHAR(255) NOT NULL,
                name VARCHAR(255) NOT NULL,
                description TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                UNIQUE KEY category_name (category, name)
            )";
            return $db->exec($sql) !== false;
        } catch (Exception $e) {
            error_log($e->getMessage());
            return false;
        }
    }

    public static function initializeDefaultData() {
        if (!self::createTable()) {
            return false;
        }

        try {
            $db = self::getDB();
            $db->beginTransaction();

            $sql = "INSERT IGNORE INTO " . static::$tablename . " (category, name, description) VALUES (:category, :name, :description)";
            $stmt = $db->prepare($sql);

            foreach (self::$defaultCategories as $category => $items) {
                foreach ($items as $name) {
                    $description = isset(self::$defaultDescriptions[$name]) ? self::$defaultDescriptions[$name] : null;
                    $stmt->execute([
                        ':category' => $category,
                        ':name' => $name,
                        ':description' => $description
                    ]);
                }
            }

            return $db->commit();
        } catch (Exception $e) {
            if ($db) {
                $db->rollBack();
            }
            error_log($e->getMessage());
            return false;
        }
    }
    
    // Оставляем статические массивы для резервного использования
    private static $categories = [
        'Моё хобби' => [
            'Преданные компаньоны',
            'Игра и радость',
            'Обучение трюкам',
            'Забота о здоровье',
            'Прогулки',
            'Общение с владельцами',
            'Комфорт дома',
            'Творчество',
            'Мероприятия и выставки',
            'Тепло и ласка'
        ],
        'Мои любимые книги' => [
            'Мастер и Маргарита',
            'Преступление и наказание',
            'Война и мир',
            'Норвежский лес',
            '1984',
            'Маленький принц',
            'Имя розы',
            'Стив Джобс',
            'Классика',
            'Современная литература'
        ],
        'Моя любимая музыка' => [
            'Led Zeppelin',
            'Pink Floyd',
            'The Rolling Stones',
            'Muse',
            'Концерты',
            'Bohemian Rhapsody',
            'Кино',
            'Рок-фестивали',
            'Классический рок',
            'Современный рок'
        ],
        'Мои любимые фильмы' => [
            'Форрест Гамп',
            'Матрица',
            'Список Шиндлера',
            'Один дома',
            'Мстители: Война бесконечности',
            'Ушедшие',
            'Психо',
            'Документальные фильмы',
            'Фантастика',
            'Комедии'
        ]
    ];
    
    private static $descriptions = [
        // Моё хобби
        'Преданные компаньоны' => 'Собаки — мои самые преданные компаньоны, они всегда рядом, когда мне нужно внимание и поддержка.',
        'Игра и радость' => 'Я люблю наблюдать за тем, как они играют и радуются жизни, ведь каждая прогулка превращается в маленькое приключение.',
        'Обучение трюкам' => 'Обучение собак новым трюкам приносит мне огромное удовольствие, особенно когда вижу результаты своих усилий.',
        'Забота о здоровье' => 'Забота о здоровье моих питомцев — важная часть моего дня, я слежу за их питанием и регулярно посещаем ветеринара.',
        'Прогулки' => 'Прогулки на свежем воздухе с собаками помогают мне оставаться активным и заряжают энергией на весь день.',
        'Общение с владельцами' => 'Общение с другими владельцами собак позволяет обмениваться опытом и узнавать новые интересные факты о наших четвероногих друзьях.',
        'Комфорт дома' => 'Я стараюсь создавать для своих собак комфортные условия дома, чтобы они чувствовали себя уютно и безопасно.',
        'Творчество' => 'Мои собаки вдохновляют меня на творчество, часто я рисую их портреты или делаю фотографии.',
        'Мероприятия и выставки' => 'Вместе мы участвуем в различных мероприятиях и выставках, где можем показать свои навыки и пообщаться с единомышленниками.',
        'Тепло и ласка' => 'В конце дня ничто не сравнится с теплом и лаской, которую дарят мне мои любимые собаки.',

        // Мои любимые книги
        'Мастер и Маргарита' => 'Одной из моих любимых книг является «Мастер и Маргарита» Михаила Булгакова, которая поражает своей глубиной и многогранностью.',
        'Преступление и наказание' => 'Также я восхищаюсь произведениями Федора Достоевского, особенно романом «Преступление и наказание», который заставляет задуматься о природе добра и зла.',
        'Война и мир' => 'Люблю читать классику, и среди моих фаворитов — Лев Толстой с его эпопеей «Война и мир».',
        'Норвежский лес' => 'Современная литература тоже занимает важное место в моем сердце, например, романы Харуки Мураками, такие как «Норвежский лес», вызывают у меня сильные эмоции.',
        '1984' => 'Фантастика — еще одно направление, которое я ценю, и здесь нельзя не упомянуть «1984» Джорджа Оруэлла, произведение, которое до сих пор актуально.',
        'Маленький принц' => 'Среди детских книг особое место занимает «Маленький принц» Антуана де Сент-Экзюпери, который учит нас видеть красоту в простых вещах.',
        'Имя розы' => 'Я также увлекаюсь историческими романами, такими как «Имя розы» Умберто Эко, где переплетаются детективный сюжет и глубокие философские размышления.',
        'Стив Джобс' => 'В жанре нон-фикшн мне нравится читать биографии великих людей, например, «Стив Джобс» Уолтера Айзексона, которая раскрывает историю успеха одного из самых известных предпринимателей нашего времени.',
        'Классика' => 'Книги занимают особое место в моей жизни, они позволяют путешествовать во времени и пространстве, не выходя из дома.',
        'Современная литература' => 'Каждая книга, которую я читаю, оставляет след в моей душе и помогает мне лучше понимать окружающий мир и самого себя.',

        // Моя любимая музыка
        'Led Zeppelin' => 'Одним из моих любимых исполнителей является группа Led Zeppelin, чьи мощные риффы и харизматичный вокал Роберта Планта завораживают с первых нот.',
        'Pink Floyd' => 'Также я обожаю Pink Floyd с их атмосферными композициями и глубокими текстами, которые заставляют задуматься о смысле жизни.',
        'The Rolling Stones' => 'Классический рок никогда не устаревает, и среди моих фаворитов — The Rolling Stones, чья музыка остается актуальной уже несколько десятилетий.',
        'Muse' => 'Современный рок тоже имеет свое место в моем плейлисте, и здесь я выделяю группы вроде Muse, которые сочетают традиционные элементы рока с новыми звуковыми экспериментами.',
        'Концерты' => 'Я люблю посещать концерты, где могу почувствовать всю мощь живой музыки и энергию толпы.',
        'Bohemian Rhapsody' => 'Некоторые песни становятся настоящими гимнами, и одна из таких — «Bohemian Rhapsody» Queen, которая сочетает в себе разные музыкальные жанры и вызывает бурю эмоций.',
        'Кино' => 'Русский рок тоже занимает важное место в моём сердце, и тут невозможно не упомянуть группу «Кино» с её культовым лидером Виктором Цоем.',
        'Рок-фестивали' => 'Рок-фестивали — это особенное событие, где можно насладиться музыкой под открытым небом и встретить единомышленников.',
        'Классический рок' => 'Рок-музыка — это моя страсть, она наполняет мою жизнь энергией и эмоциями.',
        'Современный рок' => 'Рок-музыка для меня — это способ выразить свои чувства и переживания, она вдохновляет и поддерживает в трудные моменты.',

        // Мои любимые фильмы
        'Форрест Гамп' => 'Один из моих любимых фильмов — «Форрест Гамп», который рассказывает трогательную историю о простом человеке, преодолевающем трудности и находящем счастье в мелочах.',
        'Матрица' => 'Я также обожаю фантастические фильмы, и среди них выделяется «Матрица», которая перевернула представление о жанре и заставила задуматься о природе реальности.',
        'Список Шиндлера' => 'Исторические драмы тоже занимают важное место в моем списке предпочтений, и здесь нельзя не упомянуть «Список Шиндлера», который глубоко затрагивает тему человечности и сострадания.',
        'Один дома' => 'Комедии — отличный способ поднять настроение, и одним из моих фаворитов является «Один дома», который я пересматривал множество раз.',
        'Мстители: Война бесконечности' => 'Фильмы Marvel — это отдельный вид удовольствия, и особенно мне нравятся те, где задействованы супергерои, такие как «Мстители: Война бесконечности».',
        'Ушедшие' => 'Японское кино тоже привлекает мое внимание, и фильм «Ушедшие» Акиры Куросавы оставил неизгладимое впечатление своим глубоким смыслом и визуальной красотой.',
        'Психо' => 'Триллеры и ужасы — еще один жанр, который я люблю, и тут стоит отметить «Психо» Альфреда Хичкока, ставший классикой жанра.',
        'Документальные фильмы' => 'Документальные фильмы тоже имеют свою ценность, и я часто смотрю работы таких режиссеров, как Луи Терроу, которые открывают глаза на важные социальные проблемы.',
        'Фантастика' => 'Фильмы — это источник вдохновения и возможность погрузиться в другой мир, забыть о повседневных заботах.',
        'Комедии' => 'Каждый фильм, который я выбираю, становится частью моего опыта и помогает мне лучше понять мир вокруг и самого себя.'
    ];
}
?>